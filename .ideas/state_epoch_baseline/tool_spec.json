{
    "key": "state_epoch_baseline",
    "name": "State-Epoch Baseline Analysis",
    "schema_version": "3.0.0",
    "container_image": {
        "repository": "platform/neuro-stats",
        "label": "0.0.2"
    },
    "command": {
        "file_path": "analysis/state_epoch_baseline_analysis.py",
        "entry_point": "state_epoch_baseline_analysis",
        "program_type": "PYTHON"
    },
    "params": [
        {
            "key": "cell_set_files",
            "name": "Cell Set File(s)",
            "required": true,
            "description": "ISXD cell set file(s) containing neural activity data",
            "type": {
                "param_type": "ToolPathParam",
                "multiple": true,
                "file_formats": [
                    "isxd"
                ]
            },
            "group": "Input Files"
        },
        {
            "key": "event_set_files",
            "name": "Event Set File(s)",
            "required": false,
            "description": "ISXD event set file(s) containing neural events data",
            "type": {
                "param_type": "ToolPathParam",
                "multiple": true,
                "file_formats": [
                    "isxd"
                ]
            },
            "group": "Input Files"
        },
        {
            "key": "annotations_file",
            "name": "Annotations File",
            "required": false,
            "description": "Optional experiment annotations file with state and epoch information. If not provided, uses epoch-only analysis mode.",
            "type": {
                "param_type": "ToolPathParam",
                "multiple": true,
                "file_formats": [
                    "parquet"
                ]
            },
            "group": "Input Files"
        },
        {
            "key": "column_name",
            "name": "State Column Name",
            "required": false,
            "description": "Name of the column in annotations file containing state information",
            "type": {
                "param_type": "ToolStringParam",
                "default": "state"
            },
            "group": "Analysis Parameters"
        },
        {
            "key": "state_names",
            "name": "State Names",
            "required": true,
            "description": "Comma-separated list of behavioral state names (e.g., 'rest, active, exploration')",
            "type": {
                "param_type": "ToolStringParam"
            },
            "group": "Analysis Parameters"
        },
        {
            "key": "state_colors",
            "name": "State Colors",
            "required": false,
            "description": "Comma-separated list of colors for states (e.g., 'gray, blue, green')",
            "type": {
                "param_type": "ToolStringParam",
                "default": "gray, blue, orange"
            },
            "group": "Analysis Parameters"
        },
        {
            "key": "define_epochs_by",
            "name": "Define Epochs By",
            "required": true,
            "description": "Method to define epochs. If 'files', one epoch per input cell set will be automatically defined, for the whole duration of each cell set. If 'global file time', you can define as many epochs as you want, with 0 corresponding to start time of the first cell set. If 'local file time', you can define as many epochs as you want per input cell set, with 0 corresponding to start time of each cell set.",
            "type": {
                "param_type": "ToolChoiceParam",
                "default": "global file time",
                "choices": [
                    "files",
                    "global file time",
                    "local file time"
                ],
                "display_options": [
                    "Files",
                    "Global File Time",
                    "Local File Time"
                ]
            },
            "group": "Epoch Definition"
        },
        {
            "key": "epochs",
            "name": "Epochs",
            "required": false,
            "description": "Tuples of the start and end times (in seconds) for each epoch (e.g., if 'Define Epochs by' is set to 'Global file time', (0, 600), (650, 950), (950, 1250)). If 'Define Epochs by' is set to 'Local file time', provide one list of tuple per input cell set file (e.g., [(0, 600)], [(0, 300), (300, 600)]). If 'Define Epochs by' is set to 'Files', you can leave this parameter empty.",
            "type": {
                "param_type": "ToolStringParam",
                "default": "(0, 600), (650, 950), (950, 1250)"
            },
            "group": "Epoch Definition"
        },
        {
            "key": "epoch_names",
            "name": "Epoch Names",
            "required": true,
            "description": "Comma-separated list of time epoch names (e.g., 'baseline, training, test')",
            "type": {
                "param_type": "ToolStringParam"
            },
            "group": "Analysis Parameters"
        },
        {
            "key": "epoch_colors",
            "name": "Epoch Colors",
            "required": false,
            "description": "Comma-separated list of colors for epochs (e.g., 'lightgray, lightblue, lightgreen')",
            "type": {
                "param_type": "ToolStringParam",
                "default": "lightgray, lightblue, lightgreen"
            },
            "group": "Analysis Parameters"
        },
        {
            "key": "baseline_state",
            "name": "Baseline State",
            "required": true,
            "description": "State to use as baseline for modulation calculations",
            "type": {
                "param_type": "ToolStringParam",
                "default": "rest"
            },
            "group": "Baseline Parameters"
        },
        {
            "key": "baseline_epoch",
            "name": "Baseline Epoch",
            "required": true,
            "description": "Epoch to use as baseline for modulation calculations",
            "type": {
                "param_type": "ToolStringParam",
                "default": "baseline"
            },
            "group": "Baseline Parameters"
        },
        {
            "key": "concatenate",
            "name": "Concatenate Files",
            "required": false,
            "description": "Whether to concatenate multiple input files",
            "type": {
                "param_type": "ToolBooleanParam",
                "default": true
            },
            "group": "Data Processing"
        },
        {
            "key": "trace_scale_method",
            "name": "Trace Scaling Method",
            "required": false,
            "description": "Method for scaling trace data. Baseline methods require baseline_state to be specified.",
            "type": {
                "param_type": "ToolChoiceParam",
                "default": "none",
                "choices": [
                    "none",
                    "standardize",
                    "normalize",
                    "fractional_change",
                    "standardize_baseline"
                ],
                "display_options": [
                    "None",
                    "Standardize",
                    "Normalize",
                    "Fractional change from baseline",
                    "Standardize to baseline"
                ]
            },
            "group": "Data Processing"
        },
        {
            "key": "event_scale_method",
            "name": "Event Scaling Method",
            "required": false,
            "description": "Method for scaling event data. Baseline methods require baseline_state to be specified.",
            "type": {
                "param_type": "ToolChoiceParam",
                "default": "none",
                "choices": [
                    "none",
                    "standardize",
                    "normalize",
                    "fractional_change",
                    "standardize_baseline"
                ],
                "display_options": [
                    "None",
                    "Standardize",
                    "Normalize",
                    "Fractional change from baseline",
                    "Standardize to baseline"
                ]
            },
            "group": "Data Processing"
        },
        {
            "key": "include_correlations",
            "name": "Include Correlation Analysis",
            "required": false,
            "description": "Whether to include correlation analysis",
            "type": {
                "param_type": "ToolBooleanParam",
                "default": true
            },
            "group": "Analysis Options"
        },
        {
            "key": "include_population_activity",
            "name": "Include Population Activity Analysis",
            "required": false,
            "description": "Whether to include population activity analysis",
            "type": {
                "param_type": "ToolBooleanParam",
                "default": true
            },
            "group": "Analysis Options"
        },
        {
            "key": "include_event_analysis",
            "name": "Include Event Analysis",
            "required": false,
            "description": "Whether to include event rate analysis",
            "type": {
                "param_type": "ToolBooleanParam",
                "default": true
            },
            "group": "Analysis Options"
        },
        {
            "key": "use_registered_cellsets",
            "name": "Use Registered Cellsets",
            "required": false,
            "description": "Whether to use registered cellsets from CaImAn MSR",
            "type": {
                "param_type": "ToolBooleanParam",
                "default": false
            },
            "group": "Registration Options"
        },
        {
            "key": "registration_method",
            "name": "Registration Method",
            "required": false,
            "description": "Method for cell registration detection",
            "type": {
                "param_type": "ToolChoiceParam",
                "default": "auto_detect",
                "choices": [
                    "auto_detect",
                    "caiman_msr"
                ],
                "display_options": [
                    "auto_detect",
                    "caiman_msr"
                ]
            },
            "group": "Registration Options"
        },
        {
            "key": "alpha",
            "name": "Significance Level",
            "required": false,
            "description": "Significance level for statistical tests",
            "type": {
                "param_type": "ToolFloatRangeParam",
                "default": 0.05,
                "min": 0.001,
                "max": 0.1
            },
            "group": "Statistical Parameters"
        },
        {
            "key": "n_shuffle",
            "name": "Number of Shuffles",
            "required": false,
            "description": "Number of shuffles for permutation tests",
            "type": {
                "param_type": "ToolIntRangeParam",
                "default": 1000,
                "min": 100,
                "max": 10000
            },
            "group": "Statistical Parameters"
        },
        {
            "key": "tolerance",
            "name": "Tolerance",
            "required": false,
            "description": "Tolerance for temporal alignment and file concatenation",
            "type": {
                "param_type": "ToolFloatRangeParam",
                "default": 0.0001
            },
            "group": "Data Processing Parameters"
        },
        {
            "key": "sort_by_time",
            "name": "Sort by Time",
            "required": false,
            "description": "Whether to sort cellsets by time when concatenating",
            "type": {
                "param_type": "ToolBooleanParam",
                "default": true
            },
            "group": "Data Processing Parameters"
        }
    ],
    "results": [
        {
            "key": "tool_output_group",
            "name": "Tool Outputs",
            "description": "Tool outputs",
            "file_patterns": [
                "**/*"
            ]
        }
    ],
    "resources": {
        "cpu": 1,
        "gpu": 0,
        "memory": 15000
    },
    "description": "Combined analysis of neural activity and correlations across behavioral states and time epochs with baseline comparison",
    "visibility": "public",
    "version": "2.0.0"
}